{"version":3,"file":"auth-sdk.umd.js","sources":["../node_modules/tslib/tslib.es6.js","../src/utils/request.ts","../src/constants/url.ts","../src/utils/parseUrl.ts","../src/function/login/buildLoginParams.ts","../src/function/login/authorize.ts","../src/utils/getContainer.ts","../src/components/TopBodyOverflow.tsx","../src/components/Modal.tsx","../src/constants/antdPrefix.ts","../src/function/login/popupLoginBox.tsx","../src/utils/compatibilityMe/index.ts","../src/utils/compatibilityMe/getIsAdmin.ts","../src/function/requestMe.ts","../src/function/setGlobalContextMe.ts","../src/function/requestOpBaseUrl.ts","../src/function/login/login.ts","../src/function/login/loginBySSO.ts","../src/utils/promise-reflect.ts","../src/utils/flatDeep.ts","../src/function/logout/doLogout.ts","../src/utils/requestByImage.ts","../src/function/logout/index.ts","../src/function/register.ts","../src/function/meSelector.ts","../src/function/requestMeTrySSO.ts","../src/LoginOrRegister/LoginOrRegisterContext.ts","../src/LoginOrRegister/Me/Avatar.tsx","../src/imgs/djc-logo.svg","../src/LoginOrRegister/Me/Logout.tsx","../src/LoginOrRegister/Me/PopoverContent.tsx","../src/LoginOrRegister/Me/Me.tsx","../src/LoginOrRegister/Login.tsx","../src/LoginOrRegister/Register.tsx","../src/hooks/useMe.ts","../src/LoginOrRegister/LoginOrRegister.tsx","../src/interceptor/Cache.ts","../src/interceptor/loginAndRetry.ts","../src/LoginOrRegister/LoginByPageOrRegister.tsx","../src/LoginOrRegister/LoginByPopupOrRegister.tsx","../src/interceptor/angular.ts","../src/interceptor/axios.ts","../src/function/login/buildLoginQueryString.ts","../src/function/login/loginByPage.ts","../src/function/login/loginByPopup.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import axios, { AxiosRequestConfig } from 'axios';\nimport qs from 'qs';\n\nconst request = (url: string, config?: AxiosRequestConfig) =>\n  axios({\n    url,\n    withCredentials: true,\n    paramsSerializer(params) {\n      return qs.stringify(params, { arrayFormat: 'repeat', allowDots: true });\n    },\n    ...config,\n  });\n\nexport default request;\n","export const ME_URL = (origin: string = window.location.origin) =>\n  `${origin}/gateway/v1/user?requireAvatar=true`;\n\nexport const LOGIN_URL = (origin: string = window.location.origin) => `${origin}/gateway/v1/login`;\n\nexport const OP_GET_URL = (origin: string = window.location.origin) => `${origin}/gateway/v1/op`;\n\nexport const AUTHORIZE_URL = (opBaseUrl: string) => `${opBaseUrl}/oauth/authorize`;\n\nexport const PLAT_INFO_URL = (djcGatewayBaseUrl: string) =>\n  `${djcGatewayBaseUrl}/djcsupport/domainname/getPlatformConfigure`;\n","interface ResultI {\n  href: string;\n  origin: string;\n  protocol: string;\n  host: string;\n  hostname: string;\n  port: string;\n  pathname: string;\n  search: string;\n  hash: string;\n}\n\nfunction parseUrl(url: string) {\n  const _url = url.startsWith('//') ? `${window.location.protocol}${url}` : url;\n\n  const result = {};\n  const keys = [\n    'href',\n    'origin',\n    'protocol',\n    'host',\n    'hostname',\n    'port',\n    'pathname',\n    'search',\n    'hash',\n  ];\n  const regexp = /(([^:]+:)\\/\\/(([^:/?#]+)(:\\d+)?))(\\/[^?#]*)?(\\?[^#]*)?(#.*)?/;\n\n  const match = regexp.exec(_url);\n\n  if (match) {\n    for (let i = keys.length - 1; i >= 0; --i) {\n      result[keys[i]] = match[i] ? match[i] : '';\n    }\n  }\n\n  return result as ResultI;\n}\n\nexport default parseUrl;\n","import request from '../../utils/request';\nimport { LOGIN_URL, PLAT_INFO_URL } from '../../constants/url';\nimport parseUrl from '../../utils/parseUrl';\nimport { loginSucessRedirectTargetI } from './types';\nimport OrgIdentityType from '../../enums/OrgIdentityType';\n\n/**\n * 登录目标域应用id\n * 如果传递了平台id和部署点约定使用户 ${platId}@${dp} 作为 clientId\n */\nconst getClientId = (platId: string, dp?: string, clientId?: string) => {\n  if (clientId) {\n    return clientId;\n  }\n  if (dp) {\n    return `${platId}@${dp}`;\n  }\n  return `plat@${platId}`;\n};\n\n/**\n * 登录成功跳转地址\n */\nconst getLoginSuccessRedirectUrl = (origin?: string, loginSuccessRedirectUri?: string) => {\n  if (loginSuccessRedirectUri) return loginSuccessRedirectUri;\n  return `${origin || window.location.origin}/login-app/login-success/index.html`;\n};\n\nexport interface BuildLoginParamsArgs {\n  /**\n   * 查询平台信息网关\n   */\n  djcGatewayBaseUrl: string;\n\n  /**\n   * 登录目标域\n   */\n  origin?: string;\n\n  /**\n   * who am i, 默认为 origin -> host\n   */\n  whoAmIhost?: string;\n\n  /**\n   * 平台id, 仅限内网使用\n   */\n  platId?: string;\n\n  /**\n   * 部署点, 仅限内网使用\n   */\n  dp?: string;\n\n  /**\n   * 授权页面UI\n   */\n  ui?: string;\n\n  /**\n   * 登录目标域应用id\n   */\n  clientId?: string;\n\n  /**\n   * 登录成功跳转地址\n   */\n  loginSuccessRedirectUri?: string;\n\n  /**\n   * 登录成功或失败后的跳转目标\n   * 失败时 mode = popup 时, 此参数有效\n   */\n  loginSucessRedirectTarget?: loginSucessRedirectTargetI;\n\n  /**\n   * 限制登录用户的身份类型\n   */\n  limitOrgTypes?: Array<OrgIdentityType>;\n\n  /**\n   * 错误信息\n   */\n  errorMessage?: string;\n}\n\nconst buildParams = async ({\n  origin = window.location.origin,\n  whoAmIhost,\n  djcGatewayBaseUrl,\n  platId,\n  dp,\n  ui,\n  clientId,\n  loginSuccessRedirectUri,\n  loginSucessRedirectTarget,\n  limitOrgTypes,\n  errorMessage,\n}: BuildLoginParamsArgs) => {\n  const originHost = parseUrl(origin).host;\n\n  let _platId = platId;\n\n  // 如果传递了 platId 不查询平台信息\n  if (!platId) {\n    const { data: platInfo } = await request(PLAT_INFO_URL(djcGatewayBaseUrl), {\n      params: {\n        orgDomainName: originHost,\n      },\n    });\n\n    _platId = platInfo?.platformCode;\n  }\n\n  if (!_platId) {\n    const error = `未查询到 ${originHost} 对应的平台信息, 请检查平台配置是否正确`;\n\n    // eslint-disable-next-line no-console\n    console.log(error);\n\n    return Promise.reject(new Error(error));\n  }\n\n  return {\n    ui,\n    client_id: getClientId(_platId, dp, clientId),\n    scope: whoAmIhost || originHost,\n    login_sucess_redirect_uri: getLoginSuccessRedirectUrl(origin, loginSuccessRedirectUri),\n    login_sucess_redirect_target: loginSucessRedirectTarget,\n    redirect_uri: LOGIN_URL(origin),\n    is_fpa: true,\n    error_message: errorMessage,\n    options: limitOrgTypes && {\n      limitOrgTypes,\n    },\n  };\n};\n\nexport default buildParams;\n","import request from '../../utils/request';\nimport { AUTHORIZE_URL } from '../../constants/url';\n\nconst authorize = async (opBaseUrl: string, params: object) => {\n  const response = await request(AUTHORIZE_URL(opBaseUrl), {\n    headers: {\n      Accept: 'application/json',\n      'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    params,\n  });\n\n  return response?.data || {};\n};\n\nexport default authorize;\n","/* eslint-disable no-restricted-globals */\n/**\n * 顶层窗口引用挂载节点\n */\nexport const getTopRoot = () => {\n  // try 防止跨域报错\n  try {\n    return (top?.document.querySelector('#mount-root') as HTMLElement) || top.document.body;\n  } catch (error) {\n    return document.body;\n  }\n};\n\nexport function getParent(triggerNode?: Element): HTMLElement {\n  if (triggerNode && triggerNode.parentNode) {\n    // @ts-ignore\n    return triggerNode.parentNode;\n  }\n  // fallback\n  return getTopRoot();\n}\n","/* eslint-disable no-restricted-globals */\nimport React, { useState, useEffect } from 'react';\nimport { createGlobalStyle } from 'styled-components';\n\n/**\n * 用于标记是否需要注入css\n * 避免多次注入(弹出多个drawer的时), css不能被正确清理\n * 导致body滚动条被一直禁用\n */\nexport const TOP_BODY_OVERFLOW_HIDDEN_MARK = 'gmsoft-ui-top-body-need-inject-css';\n\nexport const setBodyOverflowHidden = (val: boolean) => {\n  top[TOP_BODY_OVERFLOW_HIDDEN_MARK] = val;\n};\n\nexport const getBodyOverflowHidden = () => {\n  if (top[TOP_BODY_OVERFLOW_HIDDEN_MARK] === undefined) {\n    setBodyOverflowHidden(true);\n  }\n  return top[TOP_BODY_OVERFLOW_HIDDEN_MARK];\n};\n\nconst HiddenOverflow = createGlobalStyle`\n  body{\n    position: relative;\n    width: calc(100% - 17px);\n    overflow: hidden;\n    touch-action: none;\n  }\n`;\n\n/**\n * 标记 禁用top.body 滚动\n * didmount setBodyOverflowHidden(false)\n * willunmount setBodyOverflowHidden(true)\n */\nexport const useHiddenOverflow = () => {\n  useEffect(() => {\n    setBodyOverflowHidden(false);\n    return () => {\n      setBodyOverflowHidden(true);\n    };\n  });\n};\n\nexport default () => {\n  const [visibleProxy] = useState(() => getBodyOverflowHidden());\n  useHiddenOverflow();\n  if (visibleProxy) {\n    return <HiddenOverflow />;\n  }\n  return null;\n};\n","/* eslint-disable no-restricted-globals */\nimport React, { ReactNode } from 'react';\nimport { Modal as AntdModal, ConfigProvider } from 'antd';\nimport { ModalFuncProps, ModalProps as AntdModalProps } from 'antd/lib/modal';\nimport { StyleSheetManager } from 'styled-components';\nimport { getTopRoot, getParent } from '../utils/getContainer';\nimport TopBodyOverflow from '../components/TopBodyOverflow';\n\nconst topRoot = getTopRoot();\n\nexport interface ModalProps extends Omit<AntdModalProps, 'destroyOnClose'> {\n  children?: ReactNode;\n}\n\nconst Modal = ({ children, width, getContainer, ...rest }: ModalProps) => {\n  if (rest.visible !== true) {\n    return null;\n  }\n  return (\n    <StyleSheetManager target={topRoot}>\n      <>\n        <TopBodyOverflow />\n        <AntdModal getContainer={getContainer || getTopRoot} width={width} {...rest}>\n          <ConfigProvider getPopupContainer={getParent}>{children}</ConfigProvider>\n        </AntdModal>\n      </>\n    </StyleSheetManager>\n  );\n};\n\ntype ModalType = 'info' | 'success' | 'error' | 'warning' | 'confirm';\n\nconst createModal = (type: ModalType) => (config: ModalFuncProps) =>\n  AntdModal[type]({ getContainer: getTopRoot, ...config });\n\nModal.info = createModal('info');\nModal.success = createModal('success');\nModal.error = createModal('error');\nModal.warning = createModal('warning');\nModal.confirm = createModal('confirm');\nModal.destroyAll = AntdModal.destroyAll;\n\nexport default Modal;\n","export const ANTD_PREFIX = 'ant';\n","import React, { MutableRefObject } from 'react';\nimport ReactDOM from 'react-dom';\nimport styled from 'styled-components';\nimport Modal from '../../components/Modal';\nimport { ANTD_PREFIX } from '../../constants/antdPrefix';\n\nlet cancelLogin: () => void = () => undefined;\n\nconst LoginBoxModal = styled(Modal)`\n  &&& .${ANTD_PREFIX}-modal-body {\n    border: 3px solid #666666;\n    border-radius: 3px;\n    padding: 0;\n  }\n`;\n\nconst popupLoginBox = (\n  loginFormUrl: string,\n  onCancelLogin?: () => void,\n  closePopupRef?: MutableRefObject<Function>\n) => {\n  if (cancelLogin) cancelLogin();\n\n  const div = document.createElement('div');\n  document.body.appendChild(div);\n\n  const close = () => ReactDOM.unmountComponentAtNode(div);\n\n  cancelLogin = () => {\n    if (onCancelLogin && typeof onCancelLogin === 'function') {\n      onCancelLogin();\n    }\n    close();\n  };\n\n  ReactDOM.render(\n    <LoginBoxModal\n      visible\n      maskClosable\n      closable={false}\n      footer={null}\n      closeIcon={null}\n      onCancel={cancelLogin}\n      width={366}\n    >\n      <iframe\n        title=\"loginBox\"\n        className=\"login-form-box\"\n        src={loginFormUrl}\n        width=\"360px\"\n        height=\"440px\"\n        scrolling=\"no\"\n        style={{ margin: 0, padding: 0, display: 'block' }}\n        frameBorder=\"0\"\n      />\n    </LoginBoxModal>,\n    div\n  );\n\n  // eslint-disable-next-line no-param-reassign\n  if (closePopupRef) closePopupRef.current = close;\n\n  return close;\n};\n\nexport default popupLoginBox;\n","import getIsAdmin from './getIsAdmin';\nimport { CompatibleMeI, MeI } from '../../types/Me';\n\ninterface CompatibilityMeI {\n  (me?: MeI): CompatibleMeI | undefined;\n}\n\nconst compatibilityMe: CompatibilityMeI = me => {\n  if (!me || Object.getOwnPropertyNames(me).length === 0) return undefined;\n  return {\n    admin: getIsAdmin(me?.roles),\n    adminAreaId: me?.org?.areaId,\n    adminAreaName: me?.org?.areaName,\n    maintainPlatId: me?.additionalInformation?.mpi,\n    orgId: me?.org?.orgId,\n    orgName: me?.org?.orgName,\n    orgType: me?.org?.orgType,\n    userName: me?.realName,\n    userTypes: me?.roles ? me?.roles.join(',') : undefined,\n    deptRole: me?.additionalInformation?.deptRole,\n    isBidDown: me?.additionalInformation?.isBidDown,\n    isSj: me?.additionalInformation?.isSj,\n    orgClassNo: me?.additionalInformation?.orgClassNo,\n    organClass: me?.additionalInformation?.organClass,\n    userType: me?.additionalInformation?.userType,\n    ...me,\n  };\n};\nexport default compatibilityMe;\n","import RoleType from '../../enums/RoleType';\n\nexport default (roles?: Array<RoleType>) => {\n  if (!roles) return false;\n  return roles.findIndex(role => String(role).endsWith('01')) !== -1;\n};\n","import { AnyAction, Dispatch } from 'redux';\nimport setGlobalContextMe from './setGlobalContextMe';\nimport { ME_URL } from '../constants/url';\nimport { WHO_AM_I_HOST_KEY } from '../constants/whoAmIHostKey';\nimport request from '../utils/request';\nimport compatibilityMe from '../utils/compatibilityMe';\n\nexport default async (dispatch: Dispatch<AnyAction>, origin: string, whoAmIhost: string) => {\n  const response = await request(ME_URL(origin), {\n    params: {\n      [WHO_AM_I_HOST_KEY]: whoAmIhost,\n    },\n  });\n\n  const me = response.data;\n\n  if (!me || Object.getOwnPropertyNames(me).length === 0) return Promise.reject();\n\n  const cMe = compatibilityMe(response.data);\n\n  /**\n   * platDomain/gateway/user 始终返回此平台的用户信息, whoAmIhost 只作为鉴权使用\n   * 如果 origin 与当前访问域名不同, 不写入全局状态\n   * 即只存放'自己'平台的登录信息\n   */\n  if (!origin || window.location.origin.includes(origin)) setGlobalContextMe(dispatch, cMe);\n\n  return cMe;\n};\n","import { AnyAction, Dispatch } from 'redux';\nimport { CompatibleMeI } from '../types/Me';\n\nconst SET_GLOBAL_CONTEXT = '@@GLOBAL_CONTEXT/SET';\n\nfunction setGlobalContextMe(dispatch?: Dispatch<AnyAction>, me?: CompatibleMeI) {\n  if (dispatch) {\n    dispatch({\n      type: SET_GLOBAL_CONTEXT,\n      payload: { me },\n    });\n  }\n}\n\nexport default setGlobalContextMe;\n","import { OP_GET_URL } from '../constants/url';\nimport request from '../utils/request';\n\nexport default async (origin: string = window.location.origin, djcGatewayBaseUrl: string) => {\n  if (import.meta.env.VITE_DEPLPY === 'PM') {\n    return `${djcGatewayBaseUrl}/authing`;\n  }\n\n  const response = await request(OP_GET_URL(origin));\n\n  return response?.data?.op;\n};\n","import { MutableRefObject } from 'react';\nimport parseUrl from 'src/utils/parseUrl';\nimport buildParams from './buildLoginParams';\nimport { LoginModeI, LoginCommonArgs } from './types';\nimport authorize from './authorize';\nimport popupLoginBox from './popupLoginBox';\nimport requestMe from '../requestMe';\nimport requestOpBaseUrl from '../requestOpBaseUrl';\n\nconst gotoLoginPage = (url?: string) => {\n  if (!url) {\n    throw new Error('mode =  page, 必须指定 loginPage');\n  }\n\n  window.open(url, '_top');\n};\n\nexport interface LoginArgs extends LoginCommonArgs {\n  /**\n   * 登录模式\n   */\n  mode: LoginModeI;\n\n  /**\n   * 登录页面地址\n   * mode = page, 必须提供\n   */\n  loginPage?: string;\n\n  /**\n   * 取消登录事件处理\n   */\n  onCancelLogin?: () => void;\n\n  /**\n   * 关闭登录弹层, 由于登录之后需要重定向到登录成功页面, 所以关闭动作只有由引用来调用\n   */\n  closePopupRef?: MutableRefObject<Function>;\n}\n\nconst login = async ({\n  mode,\n  origin = window.location.origin,\n  whoAmIhost,\n  clientId,\n  platId,\n  dp,\n  ui,\n  loginPage,\n  djcGatewayBaseUrl,\n  loginSuccessRedirectUri,\n  loginSucessRedirectTarget = '_self',\n  limitOrgTypes,\n  oauthState,\n  onCancelLogin,\n  closePopupRef,\n  dispatch,\n}: LoginArgs) => {\n  const originHost = parseUrl(origin).host;\n  const _whoAmIhost = whoAmIhost || originHost;\n\n  try {\n    const me = await requestMe(dispatch, origin, _whoAmIhost);\n    return me;\n  } catch (e) {\n    const params = await buildParams({\n      origin,\n      whoAmIhost: _whoAmIhost,\n      djcGatewayBaseUrl,\n      clientId,\n      platId,\n      dp,\n      ui,\n      loginSuccessRedirectUri,\n      loginSucessRedirectTarget,\n      limitOrgTypes,\n    });\n\n    const opBaseUrl = await requestOpBaseUrl(origin, djcGatewayBaseUrl);\n\n    try {\n      const { location, res } = await authorize(opBaseUrl, {\n        response_type: 'code',\n        client_id: params.client_id,\n        redirect_uri: params.redirect_uri,\n        scope: params.scope,\n        options: params.options,\n        state: JSON.stringify({ ...params, ...oauthState }),\n      });\n\n      if (res === 0) {\n        const me = await requestMe(dispatch, origin, _whoAmIhost).catch(() => {\n          // eslint-disable-next-line no-console\n          console.error('服务器错误, 登录成功, 但获取登录用户信息失败!');\n        });\n        return me;\n      }\n\n      if (mode === 'page') {\n        gotoLoginPage(loginPage);\n      }\n\n      if (mode === 'popup') {\n        if (location) return popupLoginBox(location, onCancelLogin, closePopupRef);\n        // eslint-disable-next-line no-console\n        console.log('login error, mode=popup, authorize not response location');\n      }\n\n      if (mode === 'sso') {\n        return Promise.reject(new Error('尝试单点登录失败'));\n      }\n    } catch (error) {\n      const message =\n        error?.response?.data?.error_message ||\n        error?.response?.data?.message ||\n        error.message ||\n        '服务器端错误';\n\n      // eslint-disable-next-line no-console\n      console.error(message, error);\n\n      // 页面登录是即使 authorize 调用失败, 依然跳转\n      if (mode === 'page') {\n        gotoLoginPage(loginPage);\n      }\n    }\n  }\n};\n\nexport default login;\n","import { Dispatch, AnyAction } from 'redux';\nimport login from './login';\n\nexport interface LoginBySSOArgs {\n  /**\n   * 大家采网关地址\n   * 用于获取平台信息\n   */\n  djcGatewayBaseUrl: string;\n\n  /**\n   * 用于设置全局状态\n   */\n  dispatch: Dispatch<AnyAction>;\n\n  /**\n   * 登录目标域\n   */\n  origin?: string;\n\n  /**\n   * who am i, 默认为 origin -> host\n   */\n  whoAmIhost?: string;\n\n  /**\n   * 平台 id, 仅限内网使用\n   */\n  platId?: string;\n\n  /**\n   * 指定部署点 例如 PM, 仅限内网使用\n   */\n  dp?: string;\n\n  /**\n   * 登录目标域应用id\n   * 未指定, 使用 约定格式: “plat@平台id”\n   */\n  clientId?: string;\n\n  /**\n   * 其他state参数, 可以通过次对象传递给应用的登录接口\n   */\n  oauthState?: object;\n}\n\nexport default (args: LoginBySSOArgs) => login({ ...args, mode: 'sso' });\n","/**\n * promise reject 时, 仍然使用 resolve 返回, 可用于 [promise.all] 当某一 promise reject 时, 继续等待其他的 promise 执行完成\n * @param promise\n * @returns {*}\n */\nexport default promise =>\n  promise.then(value => ({ value, status: 'resolved' }), error => ({ error, status: 'rejected' }));\n","function flatDeep(arr: Array<any>, d = 1) {\n  return d > 0\n    ? arr.reduce((acc, val) => acc.concat(Array.isArray(val) ? flatDeep(val, d - 1) : val), [])\n    : arr.slice();\n}\n\nexport default flatDeep;\n","import request from '../../utils/request';\nimport reflect from '../../utils/promise-reflect';\nimport flatDeep from '../../utils/flatDeep';\nimport requestByImage from '../../utils/requestByImage';\n\ninterface ResultI {\n  data: {\n    apps: Array<string>;\n    ops: Array<string>;\n  };\n}\n\nconst mapUrls = (urls: Array<string> = []) => {\n  const promises = urls.filter(url => url).map((url: string) => requestByImage(url));\n  // 等待所有注销调用完成\n  return Promise.all(promises.map(reflect));\n};\n\n/**\n * 登录注销\n */\nconst doLogout = async (opBaseUrl: string, otherLogoutUrls?: Array<string>) => {\n  const { data } = await request(`${opBaseUrl}/logout`, {\n    method: 'DELETE',\n  });\n\n  let urls = data.apps || [];\n\n  /**\n   * 注销其他认证中心\n   */\n  if (data.ops && data.ops.length > 0) {\n    const promises = data.ops.map((op: string) =>\n      request(op, {\n        method: 'DELETE',\n        // 静默失败\n      }).catch(() => undefined)\n    );\n\n    const results = await Promise.all<ResultI>(promises);\n\n    if (results && results.length > 0) {\n      urls = urls.concat(flatDeep(results.map((result: ResultI) => result?.data?.apps)));\n    }\n  }\n\n  /**\n   * 注销其他的第三方单点登录, 例如政采云\n   */\n  if (otherLogoutUrls && otherLogoutUrls.length > 0) {\n    urls = urls.concat(otherLogoutUrls);\n  }\n\n  /**\n   * 处理异常情况, 如果注销失败, 第二次调用认证中心的接口会返回空列表\n   * 在此检查保证始终调用访问域名的注销接口\n   */\n  const currentOriginLogoutUrl = `${window.location.origin}/gateway/v1/logout`;\n  if (!urls.includes(currentOriginLogoutUrl)) urls.push(currentOriginLogoutUrl);\n\n  await mapUrls(urls);\n};\n\nexport default doLogout;\n","export default (src: string, timeout: number = 5000) =>\n  new Promise((resolve, reject) => {\n    const loader = new Image(0, 0);\n    loader.onload = resolve;\n    loader.onerror = reject;\n    loader.src = src;\n\n    setTimeout(() => {\n      reject();\n    }, timeout);\n  });\n","import login, { LoginArgs } from '../login/login';\nimport requestOpBaseUrl from '../requestOpBaseUrl';\n\nimport doLogout from './doLogout';\n\nexport interface LogoutSelfArgs {\n  /**\n   * 注销后的跳转地址\n   */\n  logoutRedirectUrl?: string;\n\n  /**\n   * 注销后的跳转地址目标窗口\n   */\n  logoutRedirectTarget?: string;\n\n  /**\n   * 注销其他的第三方单点登录, 例如政采云\n   */\n  otherLogoutUrls?: Array<string>;\n}\n\nexport interface LogoutArgs extends LoginArgs, LogoutSelfArgs {}\n\nexport default async ({\n  logoutRedirectUrl,\n  logoutRedirectTarget,\n  otherLogoutUrls,\n  ...loginArgs\n}: LogoutArgs) => {\n  try {\n    const opBaseUrl = await requestOpBaseUrl(loginArgs.origin, loginArgs.djcGatewayBaseUrl);\n\n    await doLogout(opBaseUrl, otherLogoutUrls);\n  } finally {\n    if (logoutRedirectUrl) {\n      /**\n       * 跳转到指定页面\n       */\n      window.open(logoutRedirectUrl, logoutRedirectTarget || '_top');\n    } else {\n      // 重新登录\n      await login(loginArgs);\n    }\n  }\n};\n","import qs from 'qs';\nimport UIType from '../enums/UIType';\nimport request from '../utils/request';\nimport { PLAT_INFO_URL } from '../constants/url';\nimport parseUrl from '../utils/parseUrl';\n\nexport interface RegisterArgs {\n  /**\n   * 授权页面 origin, 注册也部署在此域下\n   */\n  authPageOrigin: string;\n  /**\n   * 大家采网关地址\n   * 用于获取平台信息\n   */\n  djcGatewayBaseUrl: string;\n  /**\n   * 默认使用当前访问域名去查询对应的平台信息, 可以通过此参数指定域名\n   * 例如 https://www.gec123.com\n   */\n  origin?: string;\n  /**\n   * 如果指定了ui, 则使用该值, 否则从 origin 和 dp 推断 ui\n   */\n  ui?: UIType;\n  /**\n   * @部署点 例如: PM\n   */\n  dp?: string;\n}\n\nexport default async ({ authPageOrigin, origin, ui, dp, djcGatewayBaseUrl }: RegisterArgs) => {\n  // 注销, 然后跳转到登录页面\n  const registerUrl = `${authPageOrigin}/register/select-type`;\n\n  let platId: string | null = null;\n\n  const { data: platInfo } = await request(PLAT_INFO_URL(djcGatewayBaseUrl), {\n    params: {\n      orgDomainName: origin ? parseUrl(origin).host : window.location.host,\n    },\n  });\n\n  platId = platInfo?.platformCode;\n\n  window.open(\n    `${registerUrl}${qs.stringify(\n      {\n        ui,\n        platId,\n        dp,\n      },\n      { addQueryPrefix: true, encode: false }\n    )}`,\n    '_blank'\n  );\n};\n","import { GLOBAL_CONTEXT } from '../constants/namespace';\nimport { GlobalContextStateI } from '../types/GlobalContextState';\n\nexport default (state: GlobalContextStateI) => state[GLOBAL_CONTEXT].me;\n","import { CompatibleMeI } from '../types/Me';\nimport loginBySSO, { LoginBySSOArgs } from './login/loginBySSO';\n\nconst requestMeTrySSO = async (args: LoginBySSOArgs) => {\n  const me = await loginBySSO(args);\n  if (!me) return Promise.reject();\n  return me as unknown as CompatibleMeI;\n};\n\nexport default requestMeTrySSO;\n","import React from 'react';\nimport { AnyAction, Dispatch } from 'redux';\nimport { Props } from './LoginOrRegister';\n\ntype LoginOrRegisterContextI = Omit<Props, 'className'> & {\n  /**\n   * 用于设置全局状态\n   */\n  dispatch: Dispatch<AnyAction>;\n};\n\n/**\n * 配置环境\n */\nexport default React.createContext<LoginOrRegisterContextI>({\n  mode: 'page',\n  authPageOrigin: '',\n  loginPage: '',\n  djcGatewayBaseUrl: '',\n  loginSuccessRedirectUri: '/login-app/login-success/index.html',\n  toCenterPage: () => undefined,\n  dispatch: action => action,\n});\n","import { Avatar } from 'antd';\nimport React, { useMemo, useContext } from 'react';\nimport defaultAvatar from '../../imgs/djc-logo.svg';\nimport LoginOrRegisterContext from '../LoginOrRegisterContext';\n\ninterface Props {\n  path?: string;\n  className?: string;\n}\n\nexport default ({ path, className }: Props) => {\n  const { djcGatewayBaseUrl } = useContext(LoginOrRegisterContext);\n\n  const src = useMemo(() => {\n    // return 'https://lh3.googleusercontent.com/ogw/ADGmqu9g6TEN3h27tpp82Ie88Pk4W9SoLs2CRauXbDvMYQ=s32-c-mo'\n\n    if (path)\n      // eslint-disable-next-line max-len\n      return `${djcGatewayBaseUrl}/files?business=avatar&filePath=${path}&fileName=file&attachment=false&contentType=image/png`;\n    return defaultAvatar;\n  }, [djcGatewayBaseUrl, path]);\n\n  return <Avatar className={className} src={src} />;\n};\n","export default \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjIxNTk1MjI3MzMxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEzOTgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTU3NC4yMzk1MTA1NyAzMjkuMjU0MjAyODFWMTcxLjY2OTA1ODc3YzAtMy4zMTA2MTI1Ny0zLjMxMDYxMjU3LTUuOTU5MTAxNzgtNi42MjEyMjQ0NC00LjYzNDg1NzE4TDE0NS4xODQxNjAyOSAzMjAuNjQ2NjExMTJjLTEuOTg2MzY3MjcgMC42NjIxMjI2Ni0zLjMxMDYxMjU3IDIuNjQ4NDg5OTItMy4zMTA2MTE4NiA0LjYzNDg1NzE3djI1MC4yODIyODc2YzEuOTg2MzY3MjcgMTIwLjUwNjI4NjYyIDc4Ljc5MjU3MjAyIDIyMy4xMzUyNjcxOSAxODUuMzk0Mjg3MTEgMjYzLjUyNDczNjQ4IDMxLjc4MTg3NzU4IDExLjkxODIwNDI4IDY2Ljg3NDM2Nzc0IDE5LjIwMTU1MTM4IDEwMi42Mjg5Nzk4NSAxOS4yMDE1NTEzNiAzNi40MTY3MzQ3NiAwIDcwLjg0NzEwMjI2LTYuNjIxMjI0NDMgMTAyLjYyODk4MDU3LTE5LjIwMTU1MTM2IDE0LjU2NjY5NDE5LTUuMjk2OTc5ODQgMjcuODA5MTQzMDctMTEuOTE4MjA0MjggNDEuMDUxNTkxOTUtMTkuODYzNjc0MDRDNjU4Ljk5MTE4NTA5IDc3MC4yMjc3NTczNiA3MTYuNTk1ODM4NDggNjc4Ljg1NDg1ODQgNzE3LjkyMDA4MzA4IDU3My41NzczODc5MXYtNTAuMzIxMzA2M2w0MS4wNTE1OTE5NC0xNS4yMjg4MTYxMlY1NDUuMTA2MTIyOTFjMCAzLjMxMDYxMjU3IDMuMzEwNjEyNTcgNS45NTkxMDE3OCA2LjYyMTIyNTE2IDQuNjM0ODU3MTdsNzIuODMzNDY5NTItMjYuNDg0ODk4NDZjMS45ODYzNjcyNy0wLjY2MjEyMjY2IDMuMzEwNjEyNTctMi42NDg0ODk5MiAzLjMxMDYxMjU4LTQuNjM0ODU3MTl2LTQwLjM4OTQ2OTI4bDM3Ljc0MDk3OTM2LTEzLjkwNDU3MTUzYzEuOTg2MzY3MjctMC42NjIxMjI2NiAzLjMxMDYxMjU3LTIuNjQ4NDg5OTIgMy4zMTA2MTI1OC00LjYzNDg1NzE3VjIyMy45NzY3MzIzMmMwLTMuMzEwNjEyNTctMy4zMTA2MTI1Ny01Ljk1OTEwMTc4LTYuNjIxMjI0NDMtNC42MzQ4NTcxOEw1NzQuMjM5NTEwNTcgMzI5LjI1NDIwMjgxeiBtLTQxLjA1MTU5MTk0IDI0MS42NzQ2OTU5YzAgMTcuMjE1MTg0MTEtNC42MzQ4NTcxOCAzMy43NjgyNDQ4NS0xMS45MTgyMDQyOCA0OC4zMzQ5MzkwNC0xNy4yMTUxODQxMSAzMi40NDQwMDAyNC01MS42NDU1NTE2MiA1NC4yOTQwNDE1NC05MC43MTA3NzYzIDU0LjI5NDA0MDgxLTEzLjI0MjQ0ODg4IDAtMjYuNDg0ODk4NDYtMi42NDg0ODk5Mi0zOC40MDMxMDIwMS03LjI4MzM0NzEtMTUuODkwOTM4OC02LjYyMTIyNDQzLTI5Ljc5NTUxMDMzLTE2LjU1MzA2MTQ1LTQwLjM4OTQ3LTI5LjEzMzM4NzY2YTEwMS45NjY4NTc5MSAxMDEuOTY2ODU3OTEgMCAwIDEtMjQuNDk4NTMwNDktNjYuMjEyMjQ1MDl2LTY2LjIxMjI0NTgyYzAtMS45ODYzNjcyNyAxLjMyNDI0NDYtMy45NzI3MzQ1MSAzLjMxMDYxMTg2LTQuNjM0ODU3MTdMNTMzLjE4NzkxODYyIDQyNS45MjQwODA4OHYxNDUuMDA0ODE3ODR6IiBwLWlkPSIxMzk5IiBmaWxsPSIjY2RjZGNkIj48L3BhdGg+PC9zdmc+\"","/* eslint-disable max-len */\nimport React, { useCallback, useContext } from 'react';\nimport styled from 'styled-components';\nimport logout from '../../function/logout';\nimport LoginOrRegisterContext from '../LoginOrRegisterContext';\n\nconst color = (props: any) => props.theme.textColorSecondary || '#697b8c';\nconst linkColorHover = (props: any) => props.theme.linkColorHover || '#1890ff';\n\nconst Logout = styled.a`\n  color: ${color};\n  &:active {\n    color: ${color};\n  }\n  span,\n  svg {\n    vertical-align: middle;\n    color: ${color};\n    fill: ${color};\n  }\n  &:hover {\n    span,\n    svg {\n      color: ${linkColorHover};\n      fill: ${linkColorHover};\n    }\n  }\n`;\n\nexport default () => {\n  const args = useContext(LoginOrRegisterContext);\n\n  const logoutHandler = useCallback(async () => {\n    await logout(args);\n  }, [args]);\n\n  return (\n    <Logout onClick={logoutHandler}>\n      <span>退出</span>\n      <svg\n        viewBox=\"0 0 1024 1024\"\n        version=\"1.1\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        p-id=\"4393\"\n        width=\"20\"\n        height=\"20\"\n      >\n        <path\n          d=\"M593.92 838.513v-95.355a40.96 40.96 0 1 1 81.92 0v95.355c0 45.26-35.226 83.087-80.22 83.087H203.1c-44.994 0-80.22-37.827-80.22-83.087V185.487c0-45.26 35.226-83.087 80.22-83.087h392.52c44.994 0 80.22 37.827 80.22 83.087v193.946a40.96 40.96 0 1 1-81.92 0V185.487c0-1.024 0.061-1.147 0.901-1.167H203.9c0.84 0 0.901 0.164 0.901 1.167v653.026c0 1.024-0.061 1.147-0.901 1.167H594.82c-0.84 0-0.901-0.164-0.901-1.167z\"\n          p-id=\"4394\"\n        />\n        <path\n          d=\"M471.04 512h327.68q40.96 0 40.96 40.96t-40.96 40.96H471.04q-40.96 0-40.96-40.96T471.04 512z\"\n          p-id=\"4395\"\n        />\n        <path\n          d=\"M811.199 422.828L912.57 524.2q28.963 28.963 0 57.926t-57.926 0l-101.37-101.37q-28.964-28.964 0-57.927 28.962-28.963 57.925 0z\"\n          p-id=\"4396\"\n        />\n        <path\n          d=\"M753.273 625.575l101.37-101.37q28.964-28.964 57.927 0 28.963 28.962 0 57.925L811.2 683.501q-28.964 28.963-57.927 0t0-57.926z\"\n          p-id=\"4397\"\n        />\n      </svg>\n    </Logout>\n  );\n};\n","import React, { useContext } from 'react';\nimport { Menu, Typography } from 'antd';\nimport styled from 'styled-components';\nimport { MeI } from '../../types/Me';\nimport { ANTD_PREFIX } from '../../constants/antdPrefix';\nimport Avatar from './Avatar';\nimport Logout from './Logout';\nimport LoginOrRegisterContext from '../LoginOrRegisterContext';\n\nconst { Paragraph } = Typography;\n\nconst Wrap = styled.div`\n  &&& {\n    max-width: 280px;\n    margin-bottom: -6px;\n    .${ANTD_PREFIX}-menu-vertical {\n      border-right: none;\n      .${ANTD_PREFIX}-menu-item {\n        cursor: default;\n        line-height: 35px;\n        height: auto;\n        text-align: center;\n        margin: 0;\n        &.${ANTD_PREFIX}-menu-item-selected, &:active {\n          background-color: white;\n        }\n      }\n    }\n  }\n`;\n\nconst UserAvatar = styled(Avatar)`\n  &&& {\n    height: 64px;\n    width: 64px;\n    vertical-align: top;\n    border: 1px solid #dedede;\n  }\n`;\n\nconst P = styled(Paragraph).attrs({\n  ellipsis: true,\n})`\n  &&& {\n    margin: 0;\n  }\n`;\n\nconst Name = styled(P)`\n  font-size: 16px;\n  font-weight: 700;\n`;\n\ninterface Props {\n  me: MeI;\n}\n\nexport default ({ me }: Props) => {\n  const { toCenterPage } = useContext(LoginOrRegisterContext);\n  return (\n    <Wrap>\n      <Menu mode=\"vertical\">\n        <Menu.Item key=\"avatar\">\n          <UserAvatar path={me.additionalInformation?.avatar} />\n        </Menu.Item>\n        <Menu.Item key=\"name\">\n          {me.realName && (\n            <a onClick={toCenterPage}>\n              <Name>{me.realName}</Name>\n            </a>\n          )}\n          {me.org?.orgName && <P>{me.org?.orgName}</P>}\n        </Menu.Item>\n        <Menu.Divider />\n        <Menu.Item key=\"logout\">\n          <Logout />\n        </Menu.Item>\n      </Menu>\n    </Wrap>\n  );\n};\n","import React from 'react';\nimport { Popover, Typography } from 'antd';\nimport styled from 'styled-components';\nimport { MeI } from '../../types/Me';\nimport PopoverContent from './PopoverContent';\nimport Avatar from './Avatar';\n\nconst TopAvatar = styled(Avatar)`\n  &&& {\n    height: 24px;\n    width: 24px;\n    vertical-align: middle;\n    margin-right: 4px;\n  }\n`;\n\nconst { Text } = Typography;\n\nconst Name = styled(Text)`\n  &&& {\n    max-width: 150;\n    vertical-align: middle;\n  }\n`;\n\ninterface Props {\n  me: MeI;\n}\n\nexport default ({ me }: Props) => (\n  <Popover placement=\"bottom\" autoAdjustOverflow={false} content={<PopoverContent me={me} />}>\n    <TopAvatar path={me.additionalInformation?.avatar} />\n    <Name style={{ maxWidth: 150 }} ellipsis>\n      {me.realName}\n    </Name>\n  </Popover>\n);\n","import React, { useCallback, useContext } from 'react';\nimport login, { LoginArgs } from '../function/login/login';\nimport LoginOrRegisterContext from './LoginOrRegisterContext';\n\nexport default () => {\n  const args = useContext(LoginOrRegisterContext);\n  const callLogin = useCallback(() => {\n    login(args as LoginArgs);\n  }, [args]);\n\n  return (\n    <a className=\"login\" onClick={callLogin}>\n      登录\n    </a>\n  );\n};\n","import React, { useCallback, useContext } from 'react';\nimport register from '../function/register';\nimport LoginOrRegisterContext from './LoginOrRegisterContext';\n\nexport default () => {\n  const args = useContext(LoginOrRegisterContext);\n\n  const callRegister = useCallback(() => {\n    register(args);\n  }, [args]);\n\n  return (\n    <a className=\"register\" onClick={callRegister}>\n      注册\n    </a>\n  );\n};\n","import { useSelector } from 'react-redux';\nimport { meSelector } from '../function';\n\nexport default () => useSelector(meSelector);\n","import React, { useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Typography } from 'antd';\nimport styled from 'styled-components';\nimport { requestMeTrySSO } from '../function';\nimport { LoginArgs } from '../function/login/login';\nimport { RegisterArgs } from '../function/register';\nimport LoginOrRegisterContext from './LoginOrRegisterContext';\nimport Me from './Me';\nimport { LogoutSelfArgs } from '../function/logout';\nimport Login from './Login';\nimport Register from './Register';\nimport { CommonProps } from './CommonProps';\nimport useMe from '../hooks/useMe';\n\nconst { Text } = Typography;\n\nconst Or = styled(Text).attrs({\n  type: 'secondary',\n})`\n  margin: 0 8px;\n`;\n\ntype _LoginArgs = Omit<LoginArgs, 'mode' | 'dispatch'>;\n\nexport interface Props extends _LoginArgs, LogoutSelfArgs, RegisterArgs, CommonProps {\n  mode: 'page' | 'popup';\n}\n\nconst LoginOrRegister = ({ className, ...rest }: Props) => {\n  const me = useMe();\n\n  const dispatch = useDispatch();\n\n  /**\n   * 如果在全局状态中没有, 尝试请求一次\n   */\n  useEffect(() => {\n    if (!me) {\n      requestMeTrySSO({ djcGatewayBaseUrl: rest.djcGatewayBaseUrl, dispatch }).catch(() => {});\n    }\n  }, [me, dispatch, rest.djcGatewayBaseUrl]);\n\n  return (\n    <LoginOrRegisterContext.Provider value={{ dispatch, ...rest }}>\n      <div className={className}>\n        {me ? (\n          <Me me={me} />\n        ) : (\n          <>\n            <Login />\n            <Or>或</Or>\n            <Register />\n          </>\n        )}\n      </div>\n    </LoginOrRegisterContext.Provider>\n  );\n};\n\nexport default LoginOrRegister;\n","interface CacheItemI {\n  response: any;\n  resolve: any;\n  reject: (reason?: any) => void;\n}\n\ninterface CacheI {\n  [key: string]: Array<CacheItemI>;\n}\n\ninterface FlushFnI {\n  (item: CacheItemI): void;\n}\n\nconst cache: CacheI = {};\n\nconst cachePush = (key: string) => (item: CacheItemI) => {\n  if (!cache[key]) {\n    cache[key] = [];\n  }\n  cache[key].push(item);\n};\n\nconst cacheFlush = (key: string) => (fn: FlushFnI) => {\n  while (cache[key] && cache[key].length > 0) {\n    const item = cache[key].shift();\n    if (item) {\n      fn(item);\n    }\n  }\n};\n\nexport { cachePush, cacheFlush };\n","import { WHO_AM_I_HOST_KEY } from 'src/constants/whoAmIHostKey';\nimport parseUrl from '../utils/parseUrl';\nimport { LoginBySSOArgs } from '../function/login/loginBySSO';\nimport { loginBySSO } from '../function';\nimport { cachePush, cacheFlush } from './Cache';\n\n/**\n * 重新发起请求\n */\nconst reFetch = (fetcher: any, response: any, afterRetry?: Function) =>\n  fetcher({\n    ...response.config,\n    SSOInterceptorIgnore: true,\n  }).then((res: any) => {\n    if (afterRetry) afterRetry();\n    return res;\n  });\n\ninterface LoadingI {\n  [key: string]: boolean;\n}\n\n/**\n * 优化性能, 如果有多个401请求并发, 只执行第一个\n */\nconst loading: LoadingI = {};\n\n/**\n * 触发并发请求的重试\n */\nfunction retryCache(key: string, fetcher: any, afterRetry?: Function) {\n  cacheFlush(key)(item => {\n    const { response, resolve } = item;\n    resolve(reFetch(fetcher, response, afterRetry));\n  });\n}\n\n/**\n * 重试失败返回 response\n */\nfunction rejectCache(key: string, afterRetry?: Function) {\n  cacheFlush(key)(item => {\n    const { response, reject } = item;\n    reject(response);\n    if (afterRetry) afterRetry();\n  });\n}\n\n// 登录并重新发起请求\nasync function loginAndRetry(\n  args: LoginBySSOArgs,\n  response: any,\n  fetcher: any,\n  afterRetry?: Function\n) {\n  /**\n   * 获取请求的域, 尝试单点登录此域\n   */\n  const { origin } = parseUrl(response.config.url);\n  const whoAmIhost =\n    response.config && response.config.params[WHO_AM_I_HOST_KEY]\n      ? response.config.params[WHO_AM_I_HOST_KEY]\n      : parseUrl(origin).host;\n  const key = `${origin}+${whoAmIhost}`;\n\n  /**\n   * 优化性能, 如果有相同域的单点登录请求合并为一个\n   */\n  if (loading[key]) {\n    return new Promise((resolve, reject) => {\n      cachePush(key)({ response, resolve, reject });\n    });\n  }\n  /**\n   * 尝试单点登录\n   */\n  try {\n    loading[key] = true;\n    await loginBySSO({ ...args, origin, whoAmIhost });\n  } catch (e) {\n    rejectCache(key, afterRetry);\n    return Promise.reject(response);\n  } finally {\n    loading[key] = false;\n  }\n\n  /**\n   * 登录成功再次发起请求(重试并发请求)\n   */\n  retryCache(key, fetcher, afterRetry);\n\n  /**\n   * 登录成功再次发起请求\n   */\n  return reFetch(fetcher, response, afterRetry);\n}\n\nexport default loginAndRetry;\n","import React from 'react';\nimport { RegisterArgs } from '../function/register';\nimport { LoginByPageArgs } from '../function/login/loginByPage';\nimport { LogoutSelfArgs } from '../function/logout';\nimport LoginOrRegister from './LoginOrRegister';\nimport { CommonProps } from './CommonProps';\n\ntype _LoginByPageArgs = Omit<LoginByPageArgs, 'dispatch'>;\n\nexport interface Props extends _LoginByPageArgs, LogoutSelfArgs, RegisterArgs, CommonProps {}\n\nexport default (props: Props) => <LoginOrRegister mode=\"page\" {...props} />;\n","import React from 'react';\nimport { RegisterArgs } from '../function/register';\nimport { LoginByPopupArgs } from '../function/login/loginByPopup';\nimport { LogoutSelfArgs } from '../function/logout';\nimport LoginOrRegister from './LoginOrRegister';\nimport { CommonProps } from './CommonProps';\n\ntype _LoginByPopupArgs = Omit<LoginByPopupArgs, 'dispatch'>;\n\nexport interface Props extends _LoginByPopupArgs, LogoutSelfArgs, RegisterArgs, CommonProps {}\n\nexport default (props: Props) => <LoginOrRegister mode=\"popup\" {...props} />;\n","import { LoginBySSOArgs } from '../function/login/loginBySSO';\nimport loginAndRetry from './loginAndRetry';\n\n/**\n * 触发scope脏值检测\n */\nconst scopeApply = ($injector: any) => () => {\n  const $rootScope = $injector.get('$rootScope');\n  const $timeout = $injector.get('$timeout');\n\n  $timeout(() => {\n    if ($rootScope && !$rootScope.$$phase) $rootScope.$apply();\n  });\n};\n\nfunction SSOInterceptor(args: LoginBySSOArgs) {\n  window.angular\n    .module('SSOInterceptor', [])\n    .factory('SSOInterceptor', [\n      '$injector',\n      '$q',\n      function interceptor($injector: any, $q: any) {\n        return {\n          responseError(response: any) {\n            // ignore 401\n            if (!response.config || response.config.SSOInterceptorIgnore) {\n              return $q.reject(response);\n            }\n\n            if (response.status === 401) {\n              return loginAndRetry(args, response, $injector.get('$http'), scopeApply($injector));\n            }\n\n            return $q.reject(response);\n          },\n        };\n      },\n    ])\n    // eslint-disable-next-line prefer-arrow-callback\n    .config([\n      '$httpProvider',\n      function config($httpProvider: any) {\n        $httpProvider.interceptors.push('SSOInterceptor');\n      },\n    ]);\n\n  return 'SSOInterceptor';\n}\n\nexport default SSOInterceptor;\n","import axios from 'axios';\nimport { LoginBySSOArgs } from '../function/login/loginBySSO';\nimport loginAndRetry from './loginAndRetry';\n\nfunction SSOInterceptor(args: LoginBySSOArgs) {\n  return (error: any) => {\n    // ignore 401\n    if (!error.config || error.config.SSOInterceptorIgnore) {\n      return Promise.reject(error);\n    }\n\n    if (error.response.status === 401) {\n      return loginAndRetry(args, error, axios);\n    }\n\n    return Promise.reject(error);\n  };\n}\n\nexport default SSOInterceptor;\n","import qs from 'qs';\nimport buildLoginParams, { BuildLoginParamsArgs } from './buildLoginParams';\n\nexport default async (args: BuildLoginParamsArgs) => {\n  const params = await buildLoginParams(args);\n  return qs.stringify(params, { addQueryPrefix: true });\n};\n","import login from './login';\nimport { LoginCommonArgs } from './types';\n\nexport interface LoginByPageArgs extends LoginCommonArgs {\n  /**\n   * 登录页面地址\n   * mode = page, 必须提供\n   * 此页面会接受到 state 参数, 必须传递给 oauth-login 页面\n   */\n  loginPage: string;\n}\n\nexport default (args: LoginByPageArgs) => login({ ...args, mode: 'page' });\n","import { MutableRefObject } from 'react';\nimport login from './login';\nimport { LoginCommonArgs } from './types';\n\nexport interface LoginByPopupArgs extends LoginCommonArgs {\n  /**\n   * 取消登录事件处理\n   */\n  onCancelLogin?: () => void;\n\n  /**\n   * 关闭登录弹层, 由于登录之后需要重定向到登录成功页面, 所以关闭动作只有由引用来调用\n   */\n  closePopupRef?: MutableRefObject<Function>;\n}\n\nexport default (args: LoginByPopupArgs) => login({ ...args, mode: 'popup' });\n"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","thisArg","_arguments","P2","generator","Promise","resolve","reject","value","next","result","done","then","fulfilled","rejected","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","step","cooked","raw","defineProperty","request","url","config","axios","withCredentials","paramsSerializer","params","qs","stringify","arrayFormat","allowDots","ME_URL","origin","window","location","LOGIN_URL","OP_GET_URL","AUTHORIZE_URL","opBaseUrl","PLAT_INFO_URL","djcGatewayBaseUrl","_url","startsWith","protocol","keys","match","exec","getClientId","platId","dp","clientId","getLoginSuccessRedirectUrl","loginSuccessRedirectUri","buildParams","_a","_b","whoAmIhost","ui","loginSucessRedirectTarget","limitOrgTypes","errorMessage","parseUrl","host","orgDomainName","originHost","_c","platInfo","platformCode","_platId","client_id","scope","login_sucess_redirect_uri","login_sucess_redirect_target","redirect_uri","is_fpa","error_message","options","log","error","Error","authorize","headers","Accept","response","data","getTopRoot","top","document","querySelector","triggerNode","parentNode","TOP_BODY_OVERFLOW_HIDDEN_MARK","setBodyOverflowHidden","val","HiddenOverflow","createGlobalStyle","visibleProxy","useState","React","topRoot","Modal","children","width","getContainer","rest","visible","StyleSheetManager","target","TopBodyOverflow","AntdModal","ConfigProvider","getPopupContainer","getParent","createModal","type","info","success","warning","confirm","destroyAll","ANTD_PREFIX","cancelLogin","LoginBoxModal","styled","popupLoginBox","loginFormUrl","onCancelLogin","closePopupRef","div","createElement","appendChild","close","ReactDOM","unmountComponentAtNode","render","maskClosable","closable","footer","closeIcon","onCancel","title","className","src","height","scrolling","style","margin","padding","display","frameBorder","current","compatibilityMe","me","roles","getOwnPropertyNames","admin","findIndex","role","String","endsWith","adminAreaId","org","areaId","adminAreaName","areaName","maintainPlatId","additionalInformation","mpi","orgId","orgName","orgType","userName","realName","userTypes","join","deptRole","isBidDown","isSj","orgClassNo","organClass","userType","dispatch","includes","payload","cMe","gotoLoginPage","open","login","mode","loginPage","oauthState","requestMe","_whoAmIhost","_j","requestOpBaseUrl","response_type","state","JSON","location_1","catch","error_1","message","args","promise","status","arr","d","reduce","acc","concat","Array","isArray","flatDeep","slice","mapUrls","urls","promises","filter","map","loader","Image","onload","onerror","timeout","all","reflect","doLogout","otherLogoutUrls","method","apps","results","currentOriginLogoutUrl","logoutRedirectUrl","logoutRedirectTarget","loginArgs","authPageOrigin","registerUrl","addQueryPrefix","encode","requestMeTrySSO","loginBySSO","createContext","toCenterPage","action","path","useContext","LoginOrRegisterContext","useMemo","Avatar","color","props","theme","textColorSecondary","linkColorHover","Logout","a","logoutHandler","useCallback","logout","onClick","viewBox","version","xmlns","Paragraph","Typography","Wrap","UserAvatar","P","attrs","ellipsis","Name","Menu","Item","key","avatar","Divider","TopAvatar","Text","Popover","placement","autoAdjustOverflow","content","PopoverContent","maxWidth","callLogin","callRegister","useSelector","meSelector","Or","LoginOrRegister","useMe","useDispatch","Provider","Me","Login","Register","cache","cacheFlush","fn","item","shift","reFetch","fetcher","afterRetry","SSOInterceptorIgnore","res","loading","angular","module","factory","$injector","$q","responseError","loginAndRetry","get","$rootScope","$$phase","$apply","scopeApply","$httpProvider","interceptors","buildLoginParams"],"mappings":"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"}